Return-Path: <linux-usb+bounces-27675-lists+linux-usb=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-usb@lfdr.de
Delivered-To: lists+linux-usb@lfdr.de
Received: from sv.mirrors.kernel.org (sv.mirrors.kernel.org [139.178.88.99])
	by mail.lfdr.de (Postfix) with ESMTPS id 85B46B47984
	for <lists+linux-usb@lfdr.de>; Sun,  7 Sep 2025 10:11:34 +0200 (CEST)
Received: from smtp.subspace.kernel.org (relay.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-ECDSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by sv.mirrors.kernel.org (Postfix) with ESMTPS id 40F923B442E
	for <lists+linux-usb@lfdr.de>; Sun,  7 Sep 2025 08:11:33 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 1A1722185A8;
	Sun,  7 Sep 2025 08:11:27 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (1024-bit key) header.d=linuxfoundation.org header.i=@linuxfoundation.org header.b="oYl23Knw"
X-Original-To: linux-usb@vger.kernel.org
Received: from smtp.kernel.org (aws-us-west-2-korg-mail-1.web.codeaurora.org [10.30.226.201])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 82538125B2;
	Sun,  7 Sep 2025 08:11:26 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=10.30.226.201
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1757232686; cv=none; b=Mpu7tkkt4TY5TC3sbhpFdujlKzX+egXKgKi2LGhv6eUJjpmn4oB64eCFVU7wcXirRrJEhXybZobYktudBsycTMmLp6Yibt8mZD8k3o2Cz6lOZP+Dw4bo0JlsNaJa3Hm3BtPgcz6qWDEcklUNO43AM0FkKRmImh6CxKXpBeP5LH4=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1757232686; c=relaxed/simple;
	bh=zrGrQjBqBEf0r4UgOEByi5j0mtKcNf4pavFsd9wVE9w=;
	h=Date:From:To:Cc:Subject:Message-ID:References:MIME-Version:
	 Content-Type:Content-Disposition:In-Reply-To; b=tGWuNN2+kLWd2KCPYDWxGQcJbQkq5jYHgqHfl3b8aN5ZC+OIYFmSUyIpMEFRyBmzBLmBiqcXNfEVaS6raJl5sOEGZLovOjBgWlmkMML1swkndg4QHVUAYwfoa5OC9L/Sj0Yx9t8mNg7rydRzCw3kbcHkw//e4sJrP4MQx41Kqn0=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dkim=pass (1024-bit key) header.d=linuxfoundation.org header.i=@linuxfoundation.org header.b=oYl23Knw; arc=none smtp.client-ip=10.30.226.201
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 0CBEAC4CEF0;
	Sun,  7 Sep 2025 08:11:25 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=linuxfoundation.org;
	s=korg; t=1757232686;
	bh=zrGrQjBqBEf0r4UgOEByi5j0mtKcNf4pavFsd9wVE9w=;
	h=Date:From:To:Cc:Subject:References:In-Reply-To:From;
	b=oYl23Knwx6DzGqqWamFJpqv5puBx1CQmF13Fai/fVsJGJrio7p83F2XPkdt6Jg2xA
	 ms04udyTvpc3Wl3VS0Yxxf9xpk5KntxlmJnjBDVjgbjvlcvkRTWzR5J1/dS5YRcRYZ
	 /4NLg0Eqptbc3PnbvVIg3FoypBlgZRDcaC+qqco0=
Date: Sun, 7 Sep 2025 10:11:23 +0200
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: Krishna Kurapati PSSNV <krishna.kurapati@oss.qualcomm.com>
Cc: Dmitry Baryshkov <dmitry.baryshkov@oss.qualcomm.com>,
	linux-arm-msm@vger.kernel.org,
	Bjorn Andersson <bjorn.andersson@oss.qualcomm.com>,
	Thinh Nguyen <Thinh.Nguyen@synopsys.com>,
	Mathias Nyman <mathias.nyman@intel.com>, linux-usb@vger.kernel.org,
	linux-kernel@vger.kernel.org,
	Konrad Dybcio <konrad.dybcio@oss.qualcomm.com>
Subject: Re: [PATCH v4 0/3] usb: dwc3: Modify role-switching QC drd usb
 controllers
Message-ID: <2025090734-plentiful-untracked-b7ab@gregkh>
References: <20250812055542.1588528-1-krishna.kurapati@oss.qualcomm.com>
 <8629515f-5b2b-4e97-a998-05cd6eaa47cf@oss.qualcomm.com>
Precedence: bulk
X-Mailing-List: linux-usb@vger.kernel.org
List-Id: <linux-usb.vger.kernel.org>
List-Subscribe: <mailto:linux-usb+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-usb+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <8629515f-5b2b-4e97-a998-05cd6eaa47cf@oss.qualcomm.com>

On Sun, Sep 07, 2025 at 01:18:51PM +0530, Krishna Kurapati PSSNV wrote:
> 
> 
> On 8/12/2025 11:25 AM, Krishna Kurapati wrote:
> > Currently on QC targets, the conndone/disconnect events in device mode are
> > generated by controller when software writes to QSCRATCH registers in qcom
> > glue layer rather than the vbus line being routed to dwc3 core IP for it
> > to recognize and generate these events. We need to set UTMI_OTG_VBUS_VALID
> > bit of QSCRATCH_HS_PHY_CTRL register to generate a connection done event
> > and clear it to generate a disconnect event during cable removal or mode
> > switch is done
> > 
> > When the disconnect is not generated upon cable removal, the "connected"
> > flag of dwc3 is left marked as "true" and it blocks suspend routines and
> > for that to happen upon cable removal, the cable disconnect notification
> > from usb_role_switch to DWC3 core driver needs to reach DWC3 Qualcomm glue
> > driver for it generate the event.
> > 
> > Currently, the way DWC3 core and Qualcomm glue driver is designed, there
> > is no mechanism through which the DWC3 core can notify the Qualcomm glue
> > layer of any role changes which it receives from usb_role_switch. To
> > register these glue callbacks at probe time, for enabling core to notify
> > glue layer, the legacy Qualcomm driver has no way to find out when the
> > child driver probe was successful since it does not check for the same
> > during of_platform_populate.
> > 
> > For flattened implementation of the glue driver, register callbacks for
> > core to invoke and notify glue layer of role switch notifications.
> > 
> > Set-Role and Run_stop notifier callbacks have been added to inform glue
> > of changes in role and any modifications UDC might be performing on the
> > controller. These callbacks allow us to modify qscratch accordingly and
> > generate disconnect/connect events to facilitate suspend entry and proper
> > enumeration.
> > 
> > The series only allows autosuspend to be used but still relies on user
> > enabling it from userspace (echo auto > a600000.usb/power/control).
> > 
> 
> [...]
> 
> Hi Greg,
> 
>  The first two patches of this series are Acked and are independent of the
> third patch. The first two patches include glue callbacks and suspend resume
> for device mode for QC SoCs. The third patch is to enable auto-suspend for
> xhci plat and hence independent of dwc3 patches.
> 
>  If it is fine, can you take in the first two patches and I will resend the
> third one if necessary after receiving review comments from Mathias.

Can you resend just the first two, as taking patches from a longer
series is "hard" for my workflow, AND this series is not in my "to
review" queue anymore due to the other comments on the patches that you
don't want applied yet.

thanks,

greg k-h

