Return-Path: <linux-usb-owner@vger.kernel.org>
X-Original-To: lists+linux-usb@lfdr.de
Delivered-To: lists+linux-usb@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id D38B67343A
	for <lists+linux-usb@lfdr.de>; Wed, 24 Jul 2019 18:52:10 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727474AbfGXQwK (ORCPT <rfc822;lists+linux-usb@lfdr.de>);
        Wed, 24 Jul 2019 12:52:10 -0400
Received: from smtp.infotech.no ([82.134.31.41]:45864 "EHLO smtp.infotech.no"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1727469AbfGXQwK (ORCPT <rfc822;linux-usb@vger.kernel.org>);
        Wed, 24 Jul 2019 12:52:10 -0400
Received: from localhost (localhost [127.0.0.1])
        by smtp.infotech.no (Postfix) with ESMTP id 26094204194;
        Wed, 24 Jul 2019 18:52:07 +0200 (CEST)
X-Virus-Scanned: by amavisd-new-2.6.6 (20110518) (Debian) at infotech.no
Received: from smtp.infotech.no ([127.0.0.1])
        by localhost (smtp.infotech.no [127.0.0.1]) (amavisd-new, port 10024)
        with ESMTP id eZeMXtQAxSkS; Wed, 24 Jul 2019 18:51:59 +0200 (CEST)
Received: from [192.168.48.23] (host-23-251-188-50.dyn.295.ca [23.251.188.50])
        by smtp.infotech.no (Postfix) with ESMTPA id A5C74204177;
        Wed, 24 Jul 2019 18:51:58 +0200 (CEST)
To:     Guenter Roeck <linux@roeck-us.net>
Reply-To: dgilbert@interlog.com
From:   Douglas Gilbert <dgilbert@interlog.com>
Subject: lk5.1.18: tcpm: another NULL pointer deref
Cc:     USB list <linux-usb@vger.kernel.org>
Message-ID: <72587ca6-ccba-2c70-ee01-8666e0e4c506@interlog.com>
Date:   Wed, 24 Jul 2019 12:51:56 -0400
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
Content-Type: multipart/mixed;
 boundary="------------F8ABEE412856768A5BD68EA1"
Content-Language: en-CA
Sender: linux-usb-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-usb.vger.kernel.org>
X-Mailing-List: linux-usb@vger.kernel.org

This is a multi-part message in MIME format.
--------------F8ABEE412856768A5BD68EA1
Content-Type: text/plain; charset=utf-8; format=flowed
Content-Transfer-Encoding: 7bit

Hi,
Same hardware setup as last time*** (NXP OM13588 + SAMA5D2_Xplained +
lk 5.1.18) but not sure exactly how it was triggered. I was using the
NXP test monitor (NXP software) with another OM13588+KL27Z at the other
end of the USB Type C cable (it is also a PD DRP). When I looked back
at the Linux debug window I saw this:

[36749.300000] Unable to handle kernel NULL pointer dereference at virtual 
address 000001f0
[36749.310000] pgd = 41dad9a1
[36749.310000] [000001f0] *pgd=00000000
[36749.320000] Internal error: Oops: 5 [#1] THUMB2
[36749.320000] Modules linked in: tcpci tcpm
[36749.320000] CPU: 0 PID: 2338 Comm: kworker/u2:0 Not tainted 
5.1.18-sama5-armv7-r2 #6
[36749.320000] Hardware name: Atmel SAMA5
[36749.320000] Workqueue: 2-0050 tcpm_pd_rx_handler [tcpm]
[36749.320000] PC is at typec_altmode_attention+0x0/0x14
[36749.320000] LR is at tcpm_pd_rx_handler+0xa3b/0xda0 [tcpm]
[36749.320000] pc : [<c03fbee8>]    lr : [<bf8030fb>]    psr: 60030033
[36749.320000] sp : df4a9e48  ip : 00000020  fp : 00000002
[36749.320000] r10: 00000006  r9 : 00000000  r8 : 00000001
[36749.320000] r7 : deee6044  r6 : c0907008  r5 : dd4a7900  r4 : deee6040
[36749.320000] r3 : 00000001  r2 : 00001fc9  r1 : c0128525  r0 : 00000000
[36749.320000] Flags: nZCv  IRQs on  FIQs on  Mode SVC_32  ISA Thumb  Segment none
[36749.320000] Control: 50c53c7d  Table: 3c5cc059  DAC: 00000051
[36749.320000] Process kworker/u2:0 (pid: 2338, stack limit = 0x64d0912d)
[36749.320000] Stack: (0xdf4a9e48 to 0xdf4aa000)
[36749.320000] 9e40:                   00000006 00000001 ffb3b4c1 ffffffff 
c090e6c0 c090e6c0
[36749.320000] 9e60: c090e6c0 c060373c c060373c 00000000 dd4a7916 c090e6c0 
00000000 df730f00
[36749.320000] 9e80: 1fc98106 c0128525 c090e6c0 df59a040 400e0013 df4a9ea0 
df59a040 00000000
[36749.320000] 9ea0: 00000000 00000000 00000000 00000000 00000000 00000000 
00000000 c094e650
[36749.320000] 9ec0: df4a9f08 c012a647 c01031e9 c090ab8c 00000000 c0124f95 
ffffffff 00000000
[36749.320000] 9ee0: dc637580 c090e6c0 0bd6fbbc df747500 dc637580 c090e6c0 
df4a9f08 968fe74d
[36749.320000] 9f00: deea6e00 dd4a7900 ded05180 deedd100 80000000 df406000 
dd4a7904 00000000
[36749.320000] 9f20: 00000000 c012082b df406000 df406000 df4a9f48 ded05180 
df406000 ded05194
[36749.320000] 9f40: 50000000 c09132a0 df406014 df4a8000 df406000 c0120a6d 
dc5a1100 00000000
[36749.320000] 9f60: df4a9f78 dc5a1080 dc5a1100 00000000 df4a8000 ded05180 
c01209b1 df7c1eb0
[36749.320000] 9f80: dc5a1098 c012431f ffffffff dc5a1100 c0124251 00000000 
00000000 00000000
[36749.320000] 9fa0: 00000000 00000000 00000000 c01010f9 00000000 00000000 
00000000 00000000
[36749.320000] 9fc0: 00000000 00000000 00000000 00000000 00000000 00000000 
00000000 00000000
[36749.320000] 9fe0: 00000000 00000000 00000000 00000000 00000013 00000000 
00000000 00000000
[36749.320000] [<c03fbee8>] (typec_altmode_attention) from [<bf8030fb>] 
(tcpm_pd_rx_handler+0xa3b/0xda0 [tcpm])
[36749.320000] [<bf8030fb>] (tcpm_pd_rx_handler [tcpm]) from [<c012082b>] 
(process_one_work+0x123/0x2a8)
[36749.320000] [<c012082b>] (process_one_work) from [<c0120a6d>] 
(worker_thread+0xbd/0x3b0)
[36749.320000] [<c0120a6d>] (worker_thread) from [<c012431f>] (kthread+0xcf/0xf4)
[36749.320000] [<c012431f>] (kthread) from [<c01010f9>] (ret_from_fork+0x11/0x38)
[36749.320000] Exception stack(0xdf4a9fb0 to 0xdf4a9ff8)
[36749.320000] 9fa0:                                     00000000 00000000 
00000000 00000000
[36749.320000] 9fc0: 00000000 00000000 00000000 00000000 00000000 00000000 
00000000 00000000
[36749.320000] 9fe0: 00000000 00000000 00000000 00000000 00000013 00000000
[36749.320000] Code: f76d bbae 4770 bf00 (f8d0) 01f0
[36749.590000] ---[ end trace ee6ff121ba861a9f ]---

Oops also attached.

Doug Gilbert


*** Email: "Re: 5.1.18 oops: echo source > /sys/class/typec/port0/preferred_role"

--------------F8ABEE412856768A5BD68EA1
Content-Type: text/plain; charset=UTF-8;
 name="oops.txt"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="oops.txt"

WzM2NzQ5LjMwMDAwMF0gVW5hYmxlIHRvIGhhbmRsZSBrZXJuZWwgTlVMTCBwb2ludGVyIGRl
cmVmZXJlbmNlIGF0IHZpcnR1YWwgYWRkcmVzcyAwMDAwMDFmMApbMzY3NDkuMzEwMDAwXSBw
Z2QgPSA0MWRhZDlhMQpbMzY3NDkuMzEwMDAwXSBbMDAwMDAxZjBdICpwZ2Q9MDAwMDAwMDAK
WzM2NzQ5LjMyMDAwMF0gSW50ZXJuYWwgZXJyb3I6IE9vcHM6IDUgWyMxXSBUSFVNQjIKWzM2
NzQ5LjMyMDAwMF0gTW9kdWxlcyBsaW5rZWQgaW46IHRjcGNpIHRjcG0KWzM2NzQ5LjMyMDAw
MF0gQ1BVOiAwIFBJRDogMjMzOCBDb21tOiBrd29ya2VyL3UyOjAgTm90IHRhaW50ZWQgNS4x
LjE4LXNhbWE1LWFybXY3LXIyICM2ClszNjc0OS4zMjAwMDBdIEhhcmR3YXJlIG5hbWU6IEF0
bWVsIFNBTUE1ClszNjc0OS4zMjAwMDBdIFdvcmtxdWV1ZTogMi0wMDUwIHRjcG1fcGRfcnhf
aGFuZGxlciBbdGNwbV0KWzM2NzQ5LjMyMDAwMF0gUEMgaXMgYXQgdHlwZWNfYWx0bW9kZV9h
dHRlbnRpb24rMHgwLzB4MTQKWzM2NzQ5LjMyMDAwMF0gTFIgaXMgYXQgdGNwbV9wZF9yeF9o
YW5kbGVyKzB4YTNiLzB4ZGEwIFt0Y3BtXQpbMzY3NDkuMzIwMDAwXSBwYyA6IFs8YzAzZmJl
ZTg+XSAgICBsciA6IFs8YmY4MDMwZmI+XSAgICBwc3I6IDYwMDMwMDMzClszNjc0OS4zMjAw
MDBdIHNwIDogZGY0YTllNDggIGlwIDogMDAwMDAwMjAgIGZwIDogMDAwMDAwMDIKWzM2NzQ5
LjMyMDAwMF0gcjEwOiAwMDAwMDAwNiAgcjkgOiAwMDAwMDAwMCAgcjggOiAwMDAwMDAwMQpb
MzY3NDkuMzIwMDAwXSByNyA6IGRlZWU2MDQ0ICByNiA6IGMwOTA3MDA4ICByNSA6IGRkNGE3
OTAwICByNCA6IGRlZWU2MDQwClszNjc0OS4zMjAwMDBdIHIzIDogMDAwMDAwMDEgIHIyIDog
MDAwMDFmYzkgIHIxIDogYzAxMjg1MjUgIHIwIDogMDAwMDAwMDAKWzM2NzQ5LjMyMDAwMF0g
RmxhZ3M6IG5aQ3YgIElSUXMgb24gIEZJUXMgb24gIE1vZGUgU1ZDXzMyICBJU0EgVGh1bWIg
IFNlZ21lbnQgbm9uZQpbMzY3NDkuMzIwMDAwXSBDb250cm9sOiA1MGM1M2M3ZCAgVGFibGU6
IDNjNWNjMDU5ICBEQUM6IDAwMDAwMDUxClszNjc0OS4zMjAwMDBdIFByb2Nlc3Mga3dvcmtl
ci91MjowIChwaWQ6IDIzMzgsIHN0YWNrIGxpbWl0ID0gMHg2NGQwOTEyZCkKWzM2NzQ5LjMy
MDAwMF0gU3RhY2s6ICgweGRmNGE5ZTQ4IHRvIDB4ZGY0YWEwMDApClszNjc0OS4zMjAwMDBd
IDllNDA6ICAgICAgICAgICAgICAgICAgIDAwMDAwMDA2IDAwMDAwMDAxIGZmYjNiNGMxIGZm
ZmZmZmZmIGMwOTBlNmMwIGMwOTBlNmMwClszNjc0OS4zMjAwMDBdIDllNjA6IGMwOTBlNmMw
IGMwNjAzNzNjIGMwNjAzNzNjIDAwMDAwMDAwIGRkNGE3OTE2IGMwOTBlNmMwIDAwMDAwMDAw
IGRmNzMwZjAwClszNjc0OS4zMjAwMDBdIDllODA6IDFmYzk4MTA2IGMwMTI4NTI1IGMwOTBl
NmMwIGRmNTlhMDQwIDQwMGUwMDEzIGRmNGE5ZWEwIGRmNTlhMDQwIDAwMDAwMDAwClszNjc0
OS4zMjAwMDBdIDllYTA6IDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIDAw
MDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIGMwOTRlNjUwClszNjc0OS4zMjAwMDBdIDllYzA6
IGRmNGE5ZjA4IGMwMTJhNjQ3IGMwMTAzMWU5IGMwOTBhYjhjIDAwMDAwMDAwIGMwMTI0Zjk1
IGZmZmZmZmZmIDAwMDAwMDAwClszNjc0OS4zMjAwMDBdIDllZTA6IGRjNjM3NTgwIGMwOTBl
NmMwIDBiZDZmYmJjIGRmNzQ3NTAwIGRjNjM3NTgwIGMwOTBlNmMwIGRmNGE5ZjA4IDk2OGZl
NzRkClszNjc0OS4zMjAwMDBdIDlmMDA6IGRlZWE2ZTAwIGRkNGE3OTAwIGRlZDA1MTgwIGRl
ZWRkMTAwIDgwMDAwMDAwIGRmNDA2MDAwIGRkNGE3OTA0IDAwMDAwMDAwClszNjc0OS4zMjAw
MDBdIDlmMjA6IDAwMDAwMDAwIGMwMTIwODJiIGRmNDA2MDAwIGRmNDA2MDAwIGRmNGE5ZjQ4
IGRlZDA1MTgwIGRmNDA2MDAwIGRlZDA1MTk0ClszNjc0OS4zMjAwMDBdIDlmNDA6IDUwMDAw
MDAwIGMwOTEzMmEwIGRmNDA2MDE0IGRmNGE4MDAwIGRmNDA2MDAwIGMwMTIwYTZkIGRjNWEx
MTAwIDAwMDAwMDAwClszNjc0OS4zMjAwMDBdIDlmNjA6IGRmNGE5Zjc4IGRjNWExMDgwIGRj
NWExMTAwIDAwMDAwMDAwIGRmNGE4MDAwIGRlZDA1MTgwIGMwMTIwOWIxIGRmN2MxZWIwClsz
Njc0OS4zMjAwMDBdIDlmODA6IGRjNWExMDk4IGMwMTI0MzFmIGZmZmZmZmZmIGRjNWExMTAw
IGMwMTI0MjUxIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwClszNjc0OS4zMjAwMDBdIDlm
YTA6IDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIGMwMTAxMGY5IDAwMDAwMDAwIDAwMDAw
MDAwIDAwMDAwMDAwIDAwMDAwMDAwClszNjc0OS4zMjAwMDBdIDlmYzA6IDAwMDAwMDAwIDAw
MDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIDAw
MDAwMDAwClszNjc0OS4zMjAwMDBdIDlmZTA6IDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAw
IDAwMDAwMDAwIDAwMDAwMDEzIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwClszNjc0OS4z
MjAwMDBdIFs8YzAzZmJlZTg+XSAodHlwZWNfYWx0bW9kZV9hdHRlbnRpb24pIGZyb20gWzxi
ZjgwMzBmYj5dICh0Y3BtX3BkX3J4X2hhbmRsZXIrMHhhM2IvMHhkYTAgW3RjcG1dKQpbMzY3
NDkuMzIwMDAwXSBbPGJmODAzMGZiPl0gKHRjcG1fcGRfcnhfaGFuZGxlciBbdGNwbV0pIGZy
b20gWzxjMDEyMDgyYj5dIChwcm9jZXNzX29uZV93b3JrKzB4MTIzLzB4MmE4KQpbMzY3NDku
MzIwMDAwXSBbPGMwMTIwODJiPl0gKHByb2Nlc3Nfb25lX3dvcmspIGZyb20gWzxjMDEyMGE2
ZD5dICh3b3JrZXJfdGhyZWFkKzB4YmQvMHgzYjApClszNjc0OS4zMjAwMDBdIFs8YzAxMjBh
NmQ+XSAod29ya2VyX3RocmVhZCkgZnJvbSBbPGMwMTI0MzFmPl0gKGt0aHJlYWQrMHhjZi8w
eGY0KQpbMzY3NDkuMzIwMDAwXSBbPGMwMTI0MzFmPl0gKGt0aHJlYWQpIGZyb20gWzxjMDEw
MTBmOT5dIChyZXRfZnJvbV9mb3JrKzB4MTEvMHgzOCkKWzM2NzQ5LjMyMDAwMF0gRXhjZXB0
aW9uIHN0YWNrKDB4ZGY0YTlmYjAgdG8gMHhkZjRhOWZmOCkKWzM2NzQ5LjMyMDAwMF0gOWZh
MDogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMDAwMDAwMDAgMDAwMDAw
MDAgMDAwMDAwMDAgMDAwMDAwMDAKWzM2NzQ5LjMyMDAwMF0gOWZjMDogMDAwMDAwMDAgMDAw
MDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAw
MDAwMDAKWzM2NzQ5LjMyMDAwMF0gOWZlMDogMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAg
MDAwMDAwMDAgMDAwMDAwMTMgMDAwMDAwMDAKWzM2NzQ5LjMyMDAwMF0gQ29kZTogZjc2ZCBi
YmFlIDQ3NzAgYmYwMCAoZjhkMCkgMDFmMCAKWzM2NzQ5LjU5MDAwMF0gLS0tWyBlbmQgdHJh
Y2UgZWU2ZmYxMjFiYTg2MWE5ZiBdLS0tCg==
--------------F8ABEE412856768A5BD68EA1--
