Return-Path: <linux-usb-owner@vger.kernel.org>
X-Original-To: lists+linux-usb@lfdr.de
Delivered-To: lists+linux-usb@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 59A9011A0CB
	for <lists+linux-usb@lfdr.de>; Wed, 11 Dec 2019 02:55:31 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727460AbfLKBzF (ORCPT <rfc822;lists+linux-usb@lfdr.de>);
        Tue, 10 Dec 2019 20:55:05 -0500
Received: from Mailgw01.mediatek.com ([1.203.163.78]:59826 "EHLO
        mailgw01.mediatek.com" rhost-flags-OK-FAIL-OK-FAIL) by vger.kernel.org
        with ESMTP id S1726364AbfLKBzF (ORCPT
        <rfc822;linux-usb@vger.kernel.org>); Tue, 10 Dec 2019 20:55:05 -0500
X-UUID: 63826087776543caaf358b2a52a91409-20191211
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=mediatek.com; s=dk;
        h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-ID:Date:Subject:CC:To:From; bh=bR+Png5MxstYm1Mw9955IIhT3d2GEGp/XGdLQhGdPmY=;
        b=MwX3LCrjJIW5Afk36ra1m7Vq5n6lQl76zV2AyXj5GWGrdOQ7iTmL8EZITm4kEAGHyGFLY3c+K6VvU9q6SpLYbp8rLL7XEq7+6/QxVMcZ6Uo+acX7V9tncyCp31FmQeD2Ud3UhXoK2hDWNFghI3tt1aDCbgZMHNqIzI+qsDiDpWA=;
X-UUID: 63826087776543caaf358b2a52a91409-20191211
Received: from mtkcas36.mediatek.inc [(172.27.4.253)] by mailgw01.mediatek.com
        (envelope-from <min.guo@mediatek.com>)
        (mailgw01.mediatek.com ESMTP with TLS)
        with ESMTP id 952493259; Wed, 11 Dec 2019 09:54:59 +0800
Received: from mtkcas09.mediatek.inc (172.21.101.178) by
 MTKMBS31N1.mediatek.inc (172.27.4.69) with Microsoft SMTP Server (TLS) id
 15.0.1395.4; Wed, 11 Dec 2019 09:54:46 +0800
Received: from localhost.localdomain (10.17.3.153) by mtkcas09.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1395.4 via Frontend
 Transport; Wed, 11 Dec 2019 09:54:52 +0800
From:   <min.guo@mediatek.com>
To:     Bin Liu <b-liu@ti.com>, Rob Herring <robh+dt@kernel.org>
CC:     Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
        Mark Rutland <mark.rutland@arm.com>,
        Matthias Brugger <matthias.bgg@gmail.com>,
        Alan Stern <stern@rowland.harvard.edu>,
        <chunfeng.yun@mediatek.com>, <linux-usb@vger.kernel.org>,
        <devicetree@vger.kernel.org>, <linux-kernel@vger.kernel.org>,
        <linux-arm-kernel@lists.infradead.org>,
        <linux-mediatek@lists.infradead.org>, <tony@atomide.com>,
        <hdegoede@redhat.com>, Min Guo <min.guo@mediatek.com>
Subject: [PATCH v9 4/6] usb: musb: Add noirq type of dma create interface
Date:   Wed, 11 Dec 2019 09:54:44 +0800
Message-ID: <20191211015446.11477-5-min.guo@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20191211015446.11477-1-min.guo@mediatek.com>
References: <20191211015446.11477-1-min.guo@mediatek.com>
MIME-Version: 1.0
Content-Type: text/plain
X-TM-SNTS-SMTP: 05BEF10BC12BBCB5287FB9ACF4601EBBC0AAB8CFE23DE96D39AB342B24FD03BE2000:8
X-MTK:  N
Content-Transfer-Encoding: base64
Sender: linux-usb-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-usb.vger.kernel.org>
X-Mailing-List: linux-usb@vger.kernel.org

RnJvbTogTWluIEd1byA8bWluLmd1b0BtZWRpYXRlay5jb20+DQoNCkFkZCBub2lycSB0eXBlIG9m
IGRtYSBjcmVhdGUgaW50ZXJmYWNlIGZvciBwbGF0Zm9ybSB3aGljaCBkbyBub3QNCmhhdmUgZGVk
aWNhdGVkIERNQSBpbnRlcnJ1cHQgbGluZSwgbW92ZSBtdXNiaHNkbWEgbWFjcm8gZGVmaW5pdGlv
bg0KdG8gbXVzYl9kbWEuaA0KDQpTaWduZWQtb2ZmLWJ5OiBNaW4gR3VvIDxtaW4uZ3VvQG1lZGlh
dGVrLmNvbT4NCi0tLQ0KY2hhbmdlcyBpbiB2OToNCjEuIG5vIGNoYW5nZXMNCg0KY2hhbmdlcyBp
biB2ODoNCjEuIG5vIGNoYW5nZXMNCg0KY2hhbmdlcyBpbiB2NzoNCjEuIG5vIGNoYW5nZXMNCg0K
Y2hhbmdlcyBpbiB2NjoNCjEuIG5vIGNoYW5nZXMNCg0KY2hhbmdlcyBpbiB2NToNCjEuIG5vIGNo
YW5nZXMNCg0KbmV3IHBhdGNoIGJhc2VkIG9uIHY0Og0KLS0tDQogZHJpdmVycy91c2IvbXVzYi9t
dXNiX2RtYS5oICB8ICA5ICsrKysrKw0KIGRyaXZlcnMvdXNiL211c2IvbXVzYmhzZG1hLmMgfCA1
NCArKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0NCiAyIGZpbGVzIGNoYW5nZWQs
IDQ2IGluc2VydGlvbnMoKyksIDE3IGRlbGV0aW9ucygtKQ0KDQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy91c2IvbXVzYi9tdXNiX2RtYS5oIGIvZHJpdmVycy91c2IvbXVzYi9tdXNiX2RtYS5oDQppbmRl
eCA4ZjYwMjcxYzBhOWQuLjA1MTAzZWEzNzc4MyAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvdXNiL211
c2IvbXVzYl9kbWEuaA0KKysrIGIvZHJpdmVycy91c2IvbXVzYi9tdXNiX2RtYS5oDQpAQCAtMzUs
NiArMzUsMTIgQEAgc3RydWN0IG11c2JfaHdfZXA7DQogICogICAgd2hldGhlciBzaGFyZWQgd2l0
aCB0aGUgSW52ZW50cmEgY29yZSBvciBzZXBhcmF0ZS4NCiAgKi8NCiANCisjZGVmaW5lIE1VU0Jf
SFNETUFfQkFTRQkJMHgyMDANCisjZGVmaW5lIE1VU0JfSFNETUFfSU5UUgkJKE1VU0JfSFNETUFf
QkFTRSArIDApDQorI2RlZmluZSBNVVNCX0hTRE1BX0NPTlRST0wJCTB4NA0KKyNkZWZpbmUgTVVT
Ql9IU0RNQV9BRERSRVNTCQkweDgNCisjZGVmaW5lIE1VU0JfSFNETUFfQ09VTlQJCTB4Yw0KKw0K
ICNkZWZpbmUJRE1BX0FERFJfSU5WQUxJRAkofihkbWFfYWRkcl90KTApDQogDQogI2lmZGVmIENP
TkZJR19NVVNCX1BJT19PTkxZDQpAQCAtMTkxLDYgKzE5Nyw5IEBAIGV4dGVybiB2b2lkICgqbXVz
Yl9kbWFfY29udHJvbGxlcl9kZXN0cm95KShzdHJ1Y3QgZG1hX2NvbnRyb2xsZXIgKik7DQogZXh0
ZXJuIHN0cnVjdCBkbWFfY29udHJvbGxlciAqDQogbXVzYmhzX2RtYV9jb250cm9sbGVyX2NyZWF0
ZShzdHJ1Y3QgbXVzYiAqbXVzYiwgdm9pZCBfX2lvbWVtICpiYXNlKTsNCiBleHRlcm4gdm9pZCBt
dXNiaHNfZG1hX2NvbnRyb2xsZXJfZGVzdHJveShzdHJ1Y3QgZG1hX2NvbnRyb2xsZXIgKmMpOw0K
K2V4dGVybiBzdHJ1Y3QgZG1hX2NvbnRyb2xsZXIgKg0KK211c2Joc19kbWFfY29udHJvbGxlcl9j
cmVhdGVfbm9pcnEoc3RydWN0IG11c2IgKm11c2IsIHZvaWQgX19pb21lbSAqYmFzZSk7DQorZXh0
ZXJuIGlycXJldHVybl90IGRtYV9jb250cm9sbGVyX2lycShpbnQgaXJxLCB2b2lkICpwcml2YXRl
X2RhdGEpOw0KIA0KIGV4dGVybiBzdHJ1Y3QgZG1hX2NvbnRyb2xsZXIgKg0KIHR1c2JfZG1hX2Nv
bnRyb2xsZXJfY3JlYXRlKHN0cnVjdCBtdXNiICptdXNiLCB2b2lkIF9faW9tZW0gKmJhc2UpOw0K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvdXNiL211c2IvbXVzYmhzZG1hLmMgYi9kcml2ZXJzL3VzYi9t
dXNiL211c2Joc2RtYS5jDQppbmRleCA1ZmM2ODI1NzQ1ZjIuLmQ1NDljMGI4MzM2NiAxMDA2NDQN
Ci0tLSBhL2RyaXZlcnMvdXNiL211c2IvbXVzYmhzZG1hLmMNCisrKyBiL2RyaXZlcnMvdXNiL211
c2IvbXVzYmhzZG1hLmMNCkBAIC0xMCwxMiArMTAsNyBAQA0KICNpbmNsdWRlIDxsaW51eC9wbGF0
Zm9ybV9kZXZpY2UuaD4NCiAjaW5jbHVkZSA8bGludXgvc2xhYi5oPg0KICNpbmNsdWRlICJtdXNi
X2NvcmUuaCINCi0NCi0jZGVmaW5lIE1VU0JfSFNETUFfQkFTRQkJMHgyMDANCi0jZGVmaW5lIE1V
U0JfSFNETUFfSU5UUgkJKE1VU0JfSFNETUFfQkFTRSArIDApDQotI2RlZmluZSBNVVNCX0hTRE1B
X0NPTlRST0wJCTB4NA0KLSNkZWZpbmUgTVVTQl9IU0RNQV9BRERSRVNTCQkweDgNCi0jZGVmaW5l
IE1VU0JfSFNETUFfQ09VTlQJCTB4Yw0KKyNpbmNsdWRlICJtdXNiX2RtYS5oIg0KIA0KICNkZWZp
bmUgTVVTQl9IU0RNQV9DSEFOTkVMX09GRlNFVChfYmNoYW5uZWwsIF9vZmZzZXQpCQlcDQogCQko
TVVTQl9IU0RNQV9CQVNFICsgKF9iY2hhbm5lbCA8PCA0KSArIF9vZmZzZXQpDQpAQCAtMjY4LDcg
KzI2Myw3IEBAIHN0YXRpYyBpbnQgZG1hX2NoYW5uZWxfYWJvcnQoc3RydWN0IGRtYV9jaGFubmVs
ICpjaGFubmVsKQ0KIAlyZXR1cm4gMDsNCiB9DQogDQotc3RhdGljIGlycXJldHVybl90IGRtYV9j
b250cm9sbGVyX2lycShpbnQgaXJxLCB2b2lkICpwcml2YXRlX2RhdGEpDQoraXJxcmV0dXJuX3Qg
ZG1hX2NvbnRyb2xsZXJfaXJxKGludCBpcnEsIHZvaWQgKnByaXZhdGVfZGF0YSkNCiB7DQogCXN0
cnVjdCBtdXNiX2RtYV9jb250cm9sbGVyICpjb250cm9sbGVyID0gcHJpdmF0ZV9kYXRhOw0KIAlz
dHJ1Y3QgbXVzYiAqbXVzYiA9IGNvbnRyb2xsZXItPnByaXZhdGVfZGF0YTsNCkBAIC0zODMsNiAr
Mzc4LDcgQEAgc3RhdGljIGlycXJldHVybl90IGRtYV9jb250cm9sbGVyX2lycShpbnQgaXJxLCB2
b2lkICpwcml2YXRlX2RhdGEpDQogCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJm11c2ItPmxvY2ss
IGZsYWdzKTsNCiAJcmV0dXJuIHJldHZhbDsNCiB9DQorRVhQT1JUX1NZTUJPTF9HUEwoZG1hX2Nv
bnRyb2xsZXJfaXJxKTsNCiANCiB2b2lkIG11c2Joc19kbWFfY29udHJvbGxlcl9kZXN0cm95KHN0
cnVjdCBkbWFfY29udHJvbGxlciAqYykNCiB7DQpAQCAtMzk4LDE4ICszOTQsMTAgQEAgdm9pZCBt
dXNiaHNfZG1hX2NvbnRyb2xsZXJfZGVzdHJveShzdHJ1Y3QgZG1hX2NvbnRyb2xsZXIgKmMpDQog
fQ0KIEVYUE9SVF9TWU1CT0xfR1BMKG11c2Joc19kbWFfY29udHJvbGxlcl9kZXN0cm95KTsNCiAN
Ci1zdHJ1Y3QgZG1hX2NvbnRyb2xsZXIgKm11c2Joc19kbWFfY29udHJvbGxlcl9jcmVhdGUoc3Ry
dWN0IG11c2IgKm11c2IsDQotCQkJCQkJICAgIHZvaWQgX19pb21lbSAqYmFzZSkNCitzdGF0aWMg
c3RydWN0IG11c2JfZG1hX2NvbnRyb2xsZXIgKg0KK2RtYV9jb250cm9sbGVyX2FsbG9jKHN0cnVj
dCBtdXNiICptdXNiLCB2b2lkIF9faW9tZW0gKmJhc2UpDQogew0KIAlzdHJ1Y3QgbXVzYl9kbWFf
Y29udHJvbGxlciAqY29udHJvbGxlcjsNCi0Jc3RydWN0IGRldmljZSAqZGV2ID0gbXVzYi0+Y29u
dHJvbGxlcjsNCi0Jc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldiA9IHRvX3BsYXRmb3JtX2Rl
dmljZShkZXYpOw0KLQlpbnQgaXJxID0gcGxhdGZvcm1fZ2V0X2lycV9ieW5hbWUocGRldiwgImRt
YSIpOw0KLQ0KLQlpZiAoaXJxIDw9IDApIHsNCi0JCWRldl9lcnIoZGV2LCAiTm8gRE1BIGludGVy
cnVwdCBsaW5lIVxuIik7DQotCQlyZXR1cm4gTlVMTDsNCi0JfQ0KIA0KIAljb250cm9sbGVyID0g
a3phbGxvYyhzaXplb2YoKmNvbnRyb2xsZXIpLCBHRlBfS0VSTkVMKTsNCiAJaWYgKCFjb250cm9s
bGVyKQ0KQEAgLTQyMyw2ICs0MTEsMjUgQEAgc3RydWN0IGRtYV9jb250cm9sbGVyICptdXNiaHNf
ZG1hX2NvbnRyb2xsZXJfY3JlYXRlKHN0cnVjdCBtdXNiICptdXNiLA0KIAljb250cm9sbGVyLT5j
b250cm9sbGVyLmNoYW5uZWxfcmVsZWFzZSA9IGRtYV9jaGFubmVsX3JlbGVhc2U7DQogCWNvbnRy
b2xsZXItPmNvbnRyb2xsZXIuY2hhbm5lbF9wcm9ncmFtID0gZG1hX2NoYW5uZWxfcHJvZ3JhbTsN
CiAJY29udHJvbGxlci0+Y29udHJvbGxlci5jaGFubmVsX2Fib3J0ID0gZG1hX2NoYW5uZWxfYWJv
cnQ7DQorCXJldHVybiBjb250cm9sbGVyOw0KK30NCisNCitzdHJ1Y3QgZG1hX2NvbnRyb2xsZXIg
Kg0KK211c2Joc19kbWFfY29udHJvbGxlcl9jcmVhdGUoc3RydWN0IG11c2IgKm11c2IsIHZvaWQg
X19pb21lbSAqYmFzZSkNCit7DQorCXN0cnVjdCBtdXNiX2RtYV9jb250cm9sbGVyICpjb250cm9s
bGVyOw0KKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSBtdXNiLT5jb250cm9sbGVyOw0KKwlzdHJ1Y3Qg
cGxhdGZvcm1fZGV2aWNlICpwZGV2ID0gdG9fcGxhdGZvcm1fZGV2aWNlKGRldik7DQorCWludCBp
cnEgPSBwbGF0Zm9ybV9nZXRfaXJxX2J5bmFtZShwZGV2LCAiZG1hIik7DQorDQorCWlmIChpcnEg
PD0gMCkgew0KKwkJZGV2X2VycihkZXYsICJObyBETUEgaW50ZXJydXB0IGxpbmUhXG4iKTsNCisJ
CXJldHVybiBOVUxMOw0KKwl9DQorDQorCWNvbnRyb2xsZXIgPSBkbWFfY29udHJvbGxlcl9hbGxv
YyhtdXNiLCBiYXNlKTsNCisJaWYgKCFjb250cm9sbGVyKQ0KKwkJcmV0dXJuIE5VTEw7DQogDQog
CWlmIChyZXF1ZXN0X2lycShpcnEsIGRtYV9jb250cm9sbGVyX2lycSwgMCwNCiAJCQlkZXZfbmFt
ZShtdXNiLT5jb250cm9sbGVyKSwgJmNvbnRyb2xsZXItPmNvbnRyb2xsZXIpKSB7DQpAQCAtNDM3
LDMgKzQ0NCwxNiBAQCBzdHJ1Y3QgZG1hX2NvbnRyb2xsZXIgKm11c2Joc19kbWFfY29udHJvbGxl
cl9jcmVhdGUoc3RydWN0IG11c2IgKm11c2IsDQogCXJldHVybiAmY29udHJvbGxlci0+Y29udHJv
bGxlcjsNCiB9DQogRVhQT1JUX1NZTUJPTF9HUEwobXVzYmhzX2RtYV9jb250cm9sbGVyX2NyZWF0
ZSk7DQorDQorc3RydWN0IGRtYV9jb250cm9sbGVyICoNCittdXNiaHNfZG1hX2NvbnRyb2xsZXJf
Y3JlYXRlX25vaXJxKHN0cnVjdCBtdXNiICptdXNiLCB2b2lkIF9faW9tZW0gKmJhc2UpDQorew0K
KwlzdHJ1Y3QgbXVzYl9kbWFfY29udHJvbGxlciAqY29udHJvbGxlcjsNCisNCisJY29udHJvbGxl
ciA9IGRtYV9jb250cm9sbGVyX2FsbG9jKG11c2IsIGJhc2UpOw0KKwlpZiAoIWNvbnRyb2xsZXIp
DQorCQlyZXR1cm4gTlVMTDsNCisNCisJcmV0dXJuICZjb250cm9sbGVyLT5jb250cm9sbGVyOw0K
K30NCitFWFBPUlRfU1lNQk9MX0dQTChtdXNiaHNfZG1hX2NvbnRyb2xsZXJfY3JlYXRlX25vaXJx
KTsNCi0tIA0KMi4yNC4wDQo=

