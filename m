Return-Path: <linux-usb-owner@vger.kernel.org>
X-Original-To: lists+linux-usb@lfdr.de
Delivered-To: lists+linux-usb@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 447292FF2FF
	for <lists+linux-usb@lfdr.de>; Thu, 21 Jan 2021 19:15:24 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1728851AbhAUSOe (ORCPT <rfc822;lists+linux-usb@lfdr.de>);
        Thu, 21 Jan 2021 13:14:34 -0500
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:60300
        "EHLO mail3-relais-sop.national.inria.fr" rhost-flags-OK-OK-OK-OK)
        by vger.kernel.org with ESMTP id S2389592AbhAUSNj (ORCPT
        <rfc822;linux-usb@vger.kernel.org>); Thu, 21 Jan 2021 13:13:39 -0500
X-IronPort-AV: E=Sophos;i="5.79,364,1602540000"; 
   d="scan'208";a="370735789"
Received: from clt-128-93-176-60.vpn.inria.fr ([128.93.176.60])
  by mail3-relais-sop.national.inria.fr with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 21 Jan 2021 19:12:54 +0100
Date:   Thu, 21 Jan 2021 19:12:54 +0100 (CET)
From:   Julia Lawall <julia.lawall@inria.fr>
X-X-Sender: jll@hadrien
To:     Felipe Balbi <balbi@kernel.org>,
        Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
        Joel Stanley <joel@jms.id.au>,
        Andrew Jeffery <andrew@aj.id.au>,
        Tao Ren <rentao.bupt@gmail.com>,
        Benjamin Herrenschmidt <benh@kernel.crashing.org>
cc:     linux-usb@vger.kernel.org, linux-arm-kernel@lists.infradead.org,
        kbuild-all@lists.01.org,
        Sumera Priyadarsini <sylphrenadin@gmail.com>,
        linux-kernel@vger.kernel.org
Subject: [PATCH] usb: gadget: aspeed: add missing of_node_put
Message-ID: <alpine.DEB.2.22.394.2101211907060.14700@hadrien>
User-Agent: Alpine 2.22 (DEB 394 2020-01-19)
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Precedence: bulk
List-ID: <linux-usb.vger.kernel.org>
X-Mailing-List: linux-usb@vger.kernel.org

From: kernel test robot <lkp@intel.com>

Breaking out of for_each_child_of_node requires a put on the
child value.

Generated by: scripts/coccinelle/iterators/for_each_child.cocci

Fixes: 82c2d81361ec ("coccinelle: iterators: Add for_each_child.cocci script")
CC: Sumera Priyadarsini <sylphrenadin@gmail.com>
Reported-by: kernel test robot <lkp@intel.com>
Signed-off-by: kernel test robot <lkp@intel.com>
Signed-off-by: Julia Lawall <julia.lawall@inria.fr>
---

tree:   https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git master
head:   45dfb8a5659ad286c28fa59008271dbc4e5e3f2d
commit: 82c2d81361ecd142a54e84a9da1e287113314a4f coccinelle: iterators: Add for_each_child.cocci script
:::::: branch date: 17 hours ago
:::::: commit date: 3 months ago

Please take the patch only if it's a positive warning. Thanks!

 hub.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

--- a/drivers/usb/gadget/udc/aspeed-vhub/hub.c
+++ b/drivers/usb/gadget/udc/aspeed-vhub/hub.c
@@ -999,8 +999,10 @@ static int ast_vhub_of_parse_str_desc(st
 		str_array[offset].s = NULL;

 		ret = ast_vhub_str_alloc_add(vhub, &lang_str);
-		if (ret)
+		if (ret) {
+			of_node_put(child);
 			break;
+		}
 	}

 	return ret;
